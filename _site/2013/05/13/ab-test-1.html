<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# fb: http://www.facebook.com/2008/fbml">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>そのABテスト正しいですか?</title>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/font-awesome.min.css">
<!--[if IE 7]>
<link rel="stylesheet" href="/css/font-awesome-ie7.min.css">
<![endif]-->
<link rel="stylesheet" href="/css/main.css">
<link href="/css/bootstrap-responsive.min.css" rel="stylesheet">
<link rel="author" href="https://plus.google.com/102187337938024275663/posts">
<meta property="og:title" content="そのABテスト正しいですか?">
<meta property="og:type" content="article">
<meta property="og:url" content="http://kengos.jp//2013/05/13/ab-test-1.html">
<meta property="og:site_name" content="kengos.jp">
<meta property="og:locale" content="ja">

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-40855862-1', 'kengos.jp');
  ga('send', 'pageview');
</script>
</head>
<body>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="navbar navbar-inverse navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container-fluid">
      <div class="nav-collapse collapse">
        <ul class="nav">
          <li><a href="/">Home</a></li>
          <li><a href="/posts.html">Posts</a></li>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>
</div>
<div id="wrapper">
  <div id="main" class="container-fluid">
    <div class="row-fluid">
<h2>
  <a href="/2013/05/13/ab-test-1.html" >そのABテスト正しいですか?</a>
  <div class="pull-right">
    <span class="label">2013-05-13</span>
  
    <span class="label label-important">推計統計学</span>
  
    <span class="label label-important">ABテスト</span>
  
  </div>
</h2>
<div class="row-fluid">
  <div class="span12 text-right">
    <div class="fb-like" data-href="http://kengos.jp/2013/05/13/ab-test-1.html" data-send="false" data-layout="button_count" data-width="450" data-show-faces="true"></div>
    <g:plusone></g:plusone>
    <a href="http://b.hatena.ne.jp/entry/http://kengos.jp/2013/05/13/ab-test-1.html" class="hatena-bookmark-button" data-hatena-bookmark-layout="simple-balloon" title="このエントリーをはてなブックマークに追加"><img src="http://b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="http://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
    <span><a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja">ツイート</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></span>
  </div>
</div>
<h3 id='id19'>ストーリー</h3>
<div class='well'>
  A社において、広告出稿時のランディングページの効果測定のために、実施することにしました。<br />
  Aliceさんは、Aパターン、Bパターンの2種類のデザインを用意し、<br />
  ユーザが行なってほしいアクションを実行した場合を<strong>達成</strong>とし、<br />
  それ以外の場合を<strong>未達成</strong>として集計しました。
  その集計結果が以下の表です。
</div><div class='row-fluid'>
<div class='span6'>
  <table class='table table-striped'>
    <thead>
      <tr>
        <th />
        <th>達成</th>
        <th>未達成</th>
        <th>計</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Aパターン</td>
        <td>60</td>
        <td>490</td>
        <td>550</td>
      </tr>
      <tr>
        <td>Bパターン</td>
        <td>90</td>
        <td>580</td>
        <td>670</td>
      </tr>
      <tr>
        <td>計</td>
        <td>150</td>
        <td>1070</td>
        <td>1220</td>
      </tr>
    </tbody>
  </table>
</div>
</div><div class='well'>
  Aliceさんは、さらに、上記の結果を割合に変更したものを作成し、上司に以下のコメントを添えて提出しました。<br />
『Bパターンのほうが Aパターンに比べて2.52%も達成した割合が高いため、ランディングページはBパターンでいくこととします。』
</div><div class='row-fluid'>
<div class='span6'>
  <table class='table table-striped'>
    <thead>
      <tr>
        <th />
        <th>達成</th>
        <th>未達成</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Aパターン</td>
        <td>10.91%</td>
        <td>89.09%</td>
      </tr>
      <tr>
        <td>Bパターン</td>
        <td>13.43%</td>
        <td>89.09%</td>
      </tr>
    </tbody>
  </table>
</div>
</div>
<h3 id='alice'>Aliceさんの報告は正しいのか?</h3>
<div class='well'>
  今回の結果について、Aliceさんは単純に割合で結果を報告しました。<br />
  しかし、『偶然』という点を考慮するとどうでしょう?<br />
  上記の表のみでは、『偶然』このような結果になったと否定することはできません。
  『偶然』を否定するためには、<strong>推計統計学のカイ二乗検定</strong>を利用します。
</div><div class='row-fluid'>
  <dl>
    <dt>カイ二乗検定</dt>
    <dd>よくサイコロを例にされる。<br />
      サイコロは理論上どの目も1/6の確率で出現するが、実験時に『偶然』1の目が多くなった。<br />
      この『偶然』を否定したり、サイコロに歪みがあるから、1の目が多くなった。<br />
      などの推論をする際に使われる。<br />
      次を一読すると良い。<a href='http://d.hatena.ne.jp/Zellij/20111202/p1' target='_blank'>[統計]カイ二乗検定</a>
    </dd>
  </dl>
</div><p class='well'>
  サイコロの場合は、期待度がそれぞれ1/6 とすぐわかります。<br />
  しかし、この例の場合は、期待度をどのように設定すれば良いのでしょうか?<br />
</p>
<h3 id='id20'>カイ二乗値の算出</h3>
<p>以下は計算過程を示したものですので、興味が無い方は読み飛ばし推奨</p>
<h4 id='id21'>期待度の算出</h4>
<div class='well'>
  カイ二条検定において、『サイコロはどの目も1/6の確率で出現する』という期待度が必要です。<br />
  この例の場合は、以下のように期待度を算出します。
  AパターンでもBパターンでもどちらを見せても、『達成』、『未達成』は変わらないと推定する。<br />
  (つまり、今回はこのような結果になったが、実はAパターンでの達成率は10%, Bパターンも10%であると推定するような感じ。)<br />
  上記推定から、この例における期待度を算出すると以下のようになる。<br />
</div><div class='row-fluid'>
<div class='span6'>
  <table class='table table-striped'>
    <thead>
      <tr>
        <th>期待度</th>
        <th>達成</th>
        <th>未達成</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Aパターン</td>
        <td>67.62</td>
        <td>482.38</td>
      </tr>
      <tr>
        <td>Bパターン</td>
        <td>82.38</td>
        <td>587.52</td>
      </tr>
    </tbody>
  </table>
  <p class='well'>
  Aパターンの達成の期待度は、達成の合計 * Aパターンの合計 / 合計 で算出されている。(150 * 550 / 1220)<br />
  Bパターンの達成の期待度は、達成の合計 * Bパターンの合計 / 合計 で算出されている。(150 * 670 / 1220)<br />
  Aパターンの未達成の期待度は、未達成の合計 * Aパターンの合計 / 合計 で算出されている。(1070 * 550 / 1220)<br />
  Bパターンの未達成の期待度は、未達成の合計 * Bパターンの合計 / 合計 で算出されている。(1070 * 670 / 1220)<br />
  <a href='http://www.geisya.or.jp/~mwm48961/statistics/kai2.htm' target='_blank'>参考</a>
  </p>
</div>
</div>
<h4 id='id22'>カイ二乗値の計算</h4>
<div class='well'>
  期待度が算出できたら、カイ二乗値は簡単に算出できます。<br />
  実測値と期待度の表において、各項目につき以下を計算します。<br />
  <strong>(実測値 - 期待度)^2 / 期待度</strong><br />
  各項目の上記計算結果の合計が　カイ二乗値となります。
</div><div class='row-fluid'>
<div class='span6'>
  <table class='table table-striped'>
    <thead>
      <tr>
        <th />
        <th>達成</th>
        <th>未達成</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Aパターン</td>
        <td>(60 - 67.62)^2 / 67.62 = 0.8587</td>
        <td>(490 - 482.38)^2 / 482.38 = 0.1204</td>
      </tr>
      <tr>
        <td>Bパターン</td>
        <td>(90 - 82.38)^2 / 82.38 = 0.7048</td>
        <td>(580 - 587.52)^2 / 587.52 = 0.0963</td>
      </tr>
    </tbody>
  </table>
  合計すると 『1.7802』となります。<br />
  これがカイ二乗値です。
</div>
</div>
<h3 id='id23'>推定の検証</h3>
<div class='well'>今回の推定は、『AパターンでもBパターンでもどちらを見せても、『達成』、『未達成』は変わらない』という推定でした。<br />
  自由度(df)が 1 (達成,未達成の2パターンのみであるから。仮にA, B, Cの3パターンの結果がある場合は自由度は2となる。)<br />
  有意水準 5%<br />
  のおけるカイ二乗値を<a href='http://www.eco.osakafu-u.ac.jp/~kano/images/file/note_statistics/tab_chi2.pdf'>カイ二乗分布表(pdf)</a>より算出すると、
  『3.841』という値が得られる。
  カイ二乗値は, 『1.7802』であるため、カイ二乗分布表の値より小さくなり、<br />
  <strong>今回のA/Bテストの結果は、『AパターンでもBパターンでもどちらを見せても、『達成』、『未達成』は変わらない』ということになる。</strong><br />
  (仮に3.841より大きい場合は、『Bパターンのほうが、『達成』が多くなる』となる。)
</div><p class='lear'>[まとめ]<br />今回のようなA/Bテストの場合はカイ二乗値が <strong>3.841</strong>より大きくないと、A, Bどちらが優れているかをいうことができない</p>
<h3 id='id24'>簡単にカイ二乗値を計算する方法</h3>
<ul>
  <li>Excelを使う<br />いっぱい落ちているのでそれを使う(ここでは解説しない)</li>
  <li>R言語を使う(後述)</li>
</ul>
<h4 id='r'>R言語を使う方法</h4>
<p>インストールの仕方については、解説しない。<br />
  <a href='http://cse.niaes.affrc.go.jp/miwa/ja/R/setupR/index.html' target='_blank'>http://cse.niaes.affrc.go.jp/miwa/ja/R/setupR/index.html</a>
  などを参考にするとよいかもしれない。
</p><div class='well'>
  インストールができたものとして、Rコンソール上で以下のように入力すると、カイ二乗値、p値それぞれが簡単に計算できる。<br />
  <strong>matrix(c(490, 60, 580, 90))</strong>のところの数値を変化させることで、2 x 2の集計結果についてはカイ二乗値が計算できる。<br />
  なお、 2 x 3については<strong>matrix(c(a1, a2, a3, b1, b2, b3))</strong>とすればよい。
</div><pre><code>&gt; chisq.test(matrix(c(490, 60, 580, 90), ncol=2, byrow=T))

  Pearson's Chi-squared test with Yates' continuity correction

data:  matrix(c(490, 60, 580, 90), ncol = 2, byrow = T)
X-squared = 1.5577, df = 1, p-value = 0.212</code></pre><p>
  なお、この結果について p-value = 0.212 となっている点から、<br />
  このA/Bテストの結果は 『A, Bは達成、未達成に差がない状況で、21.2%の確率でこのような誤差、偶然が生じる』ということができる。<br />
  通常統計学的に認められる範囲は、5% または 1%ということを覚えておくと良いだろう。<br />
  (Rでのchisq.testの結果の値が0.05未満)
</p><p>
  また、もし今回の結果がそれぞれについて2倍のサンプル数が取得できた場合は以下のような結果となる。<br />
  p値が約7%であるので、微妙なラインだが、この程度でれば、Bパターンを採用しても良いと考えられる。
</p><pre><code>&gt; chisq.test(matrix(c(980, 120, 1160, 180), ncol=2, byrow=T))

  Pearson's Chi-squared test with Yates' continuity correction

data:  matrix(c(980, 120, 1160, 180), ncol = 2, byrow = T)
X-squared = 3.3379, df = 1, p-value = 0.0677</code></pre>
<h3 id='url_'>参考URL, 書籍</h3>
<ul>
  <li><a href='http://www.geisya.or.jp/~mwm48961/statistics/kai2.htm' target='_blank'>http://www.geisya.or.jp/~mwm48961/statistics/kai2.htm</a></li>
  <li><a href='http://d.hatena.ne.jp/Zellij/20111202/p1' target='_blank'>http://d.hatena.ne.jp/Zellij/20111202/p1</a></li>
  <li><a href='http://www.amazon.co.jp/%E7%B5%B1%E8%A8%88%E5%AD%A6%E3%81%8C%E6%9C%80%E5%BC%B7%E3%81%AE%E5%AD%A6%E5%95%8F%E3%81%A7%E3%81%82%E3%82%8B-%E8%A5%BF%E5%86%85-%E5%95%93/dp/4478022216' target='_blank'>統計学が最強の学問である(Amazon *Not アフィリエイトリンク)</a></li>
</ul>
    </div>
  </div>
  <div id="push"></div>
</div>
<footer id="footer">
  <div class="container-fluid">
    <p>Copyright (c) kengos 2013 All rights reserved.</p>
  </div>
</footer>
<script src="/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
</body>
</html>